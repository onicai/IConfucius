# Reproducible build configuration for IConfucius canister
# Tool versions - update these when upgrading
x-versions:
  dfx: &dfx 0.29.2
  mops: &mops 2.0.0

x-base-image:
  # Base image naming convention: {repo}-build:dfx-{version} (repo=IConfucius, lowercase for Docker)
  name: &base_name "iconfucius-build:dfx-0.29.2"

services:
  base:
    build:
      context: ..
      dockerfile: docker/Dockerfile.base
      args:
        DFX_VERSION: *dfx
        MOPS_VERSION: *mops
    image: *base_name
  # Image naming convention: {repo}-{canister_name}-wasm:latest (repo=IConfucius, lowercase for Docker)
  wasm:
    image: iconfucius-iconfucius-ctrlb-canister-wasm:latest
    build:
      context: ../..
      dockerfile: IConfucius/docker/Dockerfile
      args:
        IMAGE: *base_name
    volumes:
      - ../out:/app/IConfucius/out
    environment:
      DFX_WARNING: "-mainnet_plaintext_identity"
    command: bash scripts/build.sh
